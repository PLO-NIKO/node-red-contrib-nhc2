<script type="text/html" data-template-name="nhc2-config">
  <div class="form-row">
    <label for="node-config-input-autodiscover"><i class="fa fa-plug"></i> Auto Discover</label>
    <input type="checkbox" id="node-config-input-autodiscover" />
  </div>
  <div class="form-row" id="mac-select-row" style="display:none;">
    <label for="node-config-input-mac"><i class="fa fa-hashtag"></i> Select Controller (MAC)</label>
    <select id="node-config-input-mac" style="width:100%"></select>
  </div>
  <div class="form-row" id="host-row">
    <label for="node-config-input-host"><i class="fa fa-server"></i> Host</label>
    <input type="text" id="node-config-input-host" placeholder="e.g. 192.168.1.10" />
  </div>
  <div class="form-row" id="port-row">
    <label for="node-config-input-port"><i class="fa fa-plug"></i> Port</label>
    <input type="number" id="node-config-input-port" placeholder="e.g. 1883" />
  </div>
  <div class="form-row" id="username-row">
    <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
    <input type="text" id="node-config-input-username" />
  </div>
  <div class="form-row" id="password-row">
    <label for="node-config-input-password"><i class="fa fa-key"></i> Password</label>
    <input type="password" id="node-config-input-password" />
  </div>
  <div class="form-row">
    <label for="node-config-input-debug"><i class="fa fa-bug"></i> Debug</label>
    <input type="checkbox" id="node-config-input-debug" />
  </div>
  <div class="form-row">
    <label for="node-config-input-watchdog"><i class="fa fa-shield"></i> Watchdog</label>
    <input type="checkbox" id="node-config-input-watchdog" />
  </div>
  <div class="form-row">
    <label for="node-config-input-use-secrets"><i class="fa fa-lock"></i> Use Secrets</label>
    <input type="checkbox" id="node-config-input-use-secrets"
           title="Use secrets from secure storage" />
  </div>
  <div class="form-row">
    <button type="button" id="node-config-refresh" class="primary">Refresh Devices</button>
  </div>
</script>

<script type="text/javascript">
RED.nodes.registerType('nhc2-config',{
    category: 'config',
    defaults: {
        name:        {value:""},
        autodiscover:{value:false},
        mac:         {value:""},
        host:        {value:""},
        port:        {value:""},
        username:    {value:""},
        password:    {value:""},
        debug:       {value:false},
        watchdog:    {value:false},
        use_secrets: {value:false}
    },
    label: function() {
        return this.name||"nhc2-config";
    },
    oneditprepare: function() {
        var macRow      = $("#mac-select-row"),
            hostRow     = $("#host-row"),
            portRow     = $("#port-row"),
            usernameRow = $("#username-row"),
            passwordRow = $("#password-row"),
            autodisc    = $("#node-config-input-autodiscover"),
            useSecrets  = $("#node-config-input-use-secrets");

        function toggleFields() {
            if (useSecrets.is(':checked')) {
                if (!autodisc.is(':checked')) {
                    window.alert('“Use Secrets” works only when Auto-Discover is enabled.');
                    useSecrets.prop('checked',false);
                    return;
                }
                hostRow.hide();
                portRow.hide();
                usernameRow.hide();
                passwordRow.hide();
                macRow.show();
            } else {
                portRow.show();
                usernameRow.show();
                passwordRow.show();
                if (autodisc.is(':checked')) {
                    macRow.show();
                    hostRow.hide();
                } else {
                    macRow.hide();
                    hostRow.show();
                }
            }
        }

        autodisc.on('change', toggleFields);
        useSecrets.on('change', toggleFields);

        // initial visibility
        if (this.autodiscover) {
            macRow.show();  hostRow.hide();
        } else {
            macRow.hide();  hostRow.show();
        }
        portRow.show();
        usernameRow.show();
        passwordRow.show();
    }
});
</script>
